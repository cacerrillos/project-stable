<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/polymer-sortablejs/polymer-sortablejs.html">
<link rel="import" href="presentation-row.html">
<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->

<dom-module id="signup-page">
  <template>
    <style>
      :host {
        display: block;
      }
      paper-material {
        padding: 8px;
        margin-bottom: 16px;
      }
      h1, h2, h3, h4, h5, h6 {
        margin: 0;
      }
      presentation-row:hover {
        background-color: #e6e6e6;
      }
    </style>
    Signup Page
    <div id="content">
      <template is="dom-repeat" items="[[dates]]" as="date">
        <template is="dom-repeat" items="[[blocks]]" as="block">
          <paper-material elevation="1">
            <h3>[[_parseDate(date.date)]] - [[block.text]] Block</h3>
            <sortable-js class$="[[_computeSorter(date.date, block.id)]]" draggable="presentation-row" handle=".handle" data-id-attr="data-id" on-update="_sortableUpdate">
              <template is="dom-repeat" items="[[_filterPresentations(date.date, block.id, presentations)]]" as="presentation">
                <presentation-row
                  data="[[presentation]]"
                  order="[[block.order]]"
                  data-id$="[[presentation.id]]"
                  on-move-up="_doMoveUp"
                  on-move-down="_doMoveDown"
                  ></presentation-row>
              </template>
            </sortable-js>
            
          </paper-material>
        </template>

        
      </template>
    </div>
  </template>
  <script>
    Polymer({
      is: 'signup-page',
      properties: {
        dates: {
          type: Array,
          value: [
            { date: "03 27 2017" }
          ]
        },
        blocks: {
          type: Object,
          value: [
            { id: 1, text: "1st" },
            { id: 2, text: "2nd" },
            { id: 3, text: "3rd" },

          ]
        },
        presentations: {
          type: Object,
          value: {
            "1": { id: 1, date: "03 27 2017", block: 1, title: "Software Engineering 1" },
            "2": { id: 2, date: "03 27 2017", block: 1, title: "Criminal Prosecutor 1" },
            "3": { id: 3, date: "03 27 2017", block: 1, title: "Business Law 1" },
            "4": { id: 4, date: "03 27 2017", block: 1, title: "Graphic Design 1" },
            "5": { id: 5, date: "03 27 2017", block: 1, title: "Forensics: CSI 1" },
            "6": { id: 6, date: "03 27 2017", block: 1, title: "Geneology 1" },
            "7": { id: 7, date: "03 27 2017", block: 1, title: "Voice Acting 1" },

            "8": { id: 8, date: "03 27 2017", block: 2, title: "Software Engineering 2" },
            "9": { id: 9, date: "03 27 2017", block: 2, title: "Criminal Prosecutor 2" },
            "10": { id: 10, date: "03 27 2017", block: 2, title: "Business Law 2" },
            "11": { id: 11, date: "03 27 2017", block: 2, title: "Graphic Design 2" },
            "12": { id: 12, date: "03 27 2017", block: 2, title: "Forensics: CSI 2" },
            "13": { id: 13, date: "03 27 2017", block: 2, title: "Geneology 2" },
            "14": { id: 14, date: "03 27 2017", block: 2, title: "Voice Acting 2" },

            "15": { id: 15, date: "03 27 2017", block: 3, title: "Software Engineering 3" },
            "16": { id: 16, date: "03 27 2017", block: 3, title: "Criminal Prosecutor 3" },
            "17": { id: 17, date: "03 27 2017", block: 3, title: "Business Law 3" },
            "18": { id: 18, date: "03 27 2017", block: 3, title: "Graphic Design 3" },
            "19": { id: 19, date: "03 27 2017", block: 3, title: "Forensics: CSI 3" },
            "20": { id: 20, date: "03 27 2017", block: 3, title: "Geneology 3" },
            "21": { id: 21, date: "03 27 2017", block: 3, title: "Voice Acting 3" }
          }
        }
      },
      _parseDate: function(e) {
        return new Date(e).toDateString();
      },
      _getPresentations: function(dateblock, presentations) {
        return presentations[dateblock.guid];
      },
      _filterPresentations: function(date, block, presentations) {
        var result = [];

        for(var k in presentations) {
          if(!presentations.hasOwnProperty(k)) continue;
          
          var thisPresentation = presentations[k];

          if(thisPresentation.date === date && thisPresentation.block === block)
            result.push(thisPresentation);
        }

        return result;
      },
      _sortableUpdate: function(e) {
        console.log(e);
        console.log(e.target.sortable.toArray());
        console.log(e.model.set('block.order', e.target.sortable.toArray()));
        console.log(e.model.get('block.order'));
      },
      _sortableAdd: function(e) {
        console.log(e);
      },
      _doMoveUp: function(e) {
        console.log("Move " + e.detail.id + " up in " + this._computeSorter(e.detail.date, e.detail.block));
      },
      _doMoveDown: function(e) {
        console.log(e);
        var s = this._computeSorter(e.detail.date, e.detail.block);
        console.log("Move " + e.detail.id + " down in " + this._computeSorter(e.detail.date, e.detail.block));
        console.log(Polymer.dom(this.$.content).getEffectiveChildren());//("." + s));
      },
      _computeSorter: function(date, block) {
        return (date + "-" + block).replace(/\s/g, "-");
      }
    });
  </script>
</dom-module>