<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/ctech-dialogs/ctech-confirm-dialog.html">
<link rel="import" href="../../bower_components/ctech-dialogs/ctech-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="stable-behavior.html">


<!--
A comment describing this element

Example:

    <my-elem></my-elem>

Example:

    <my-elem>
      <h2>Hello my-elem</h2>
    </my-elem>

@demo demo/index.html
-->

<dom-module id="stable-dialogs">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        display: block;
      }
    </style>
    <ctech-confirm-dialog id="confirmDialog" modal>
      <ctech-ajax
        id="signupAjax"
        url="[[_computeAPI('/signup')]]"
        method="POST"
        content-type="application/json"
        handle-as="json"
        callbacks="[[confirmData.callbacks]]"
        body="[[_toJson(confirmData.data)]]"
        ></ctech-ajax>
      <div class="layout vertical">
        <h2>Confirm</h2>
        <p>Are you sure this information is correct?</p>
        <div>First Name: <b>[[confirmData.data.firstname]]</b></div>
        <div>Last Name: <b>[[confirmData.data.lastname]]</b></div>
        <div>Grade: <b>[[_getAttrFromObj(confirmData.data.grade, 'grade_name', grades)]]</b></div>
        <div>House: <b>[[_getAttrFromObj(confirmData.data.house, 'house_name', houses)]]</b></div>
      </div>
      
    </ctech-confirm-dialog>
    <paper-dialog id="postBeginDialog" modal>
      <div class="layout horizontal">
        <div class="flex"></div>
        <h2>Getting Ready!</h2>
        <div class="flex"></div>
      </div>
      <div class="layout horizontal" style="margin-top: 8px; margin-bottom: 4px;">
        <div class="flex"></div>
        <p style="margin: 0px;">Fetching presentation data...</p>
        <div class="flex"></div>
      </div>
      <div class="layout horizontal" style="margin-top: 4px; margin-bottom: 8px;">
        <div class="flex"></div>
        <b>Please don't reload.</b  >
        <div class="flex"></div>
      </div>
      <div class="layout horizontal" style="margin-top: 8px;">
        <div class="flex"></div>
        <paper-spinner active></paper-spinner>
        <div class="flex"></div>
      </div>
    </paper-dialog>
  </template>
  <script>
    Polymer({
      is: 'stable-dialogs',
      properties: {
        confirmData: {
          type: Object
        },
        grades: {
          type: Object
        },
        houses: {
          type: Object
        }
      },
      listeners: {
        'iron-ajax-request': '_onIronAjaxRequest',
        'iron-ajax-response': '_onIronAjaxResponse',
        'iron-ajax-error': '_onIronAjaxError'
      },
      behaviors: [ StableBehavior ],
      _onIronAjaxRequest: function(e) {
        e.target.callbacks.requestCallback(e);
      },
      _onIronAjaxResponse: function(e) {;
        e.target.callbacks.responseCallback(e);
      },
      _onIronAjaxError: function(e) {
        e.target.callbacks.errorCallback(e);
      },
      signupConfirmOpen: function(e) {
        this.confirmData = e.detail;
        this.$.confirmDialog.open();
      },
      signupConfirmClose: function(e) {
        this.$.confirmDialog.close();
      },
      postBeginOpen: function(e) {
        this.$.postBeginDialog.open();
      },
      postBeginClose: function(e) {
        this.$.postBeginDialog.close();
      },
      _submit: function() {
      },
      ready: function() {
        document.addEventListener('dialog-signup-confirm-open', this.signupConfirmOpen.bind(this));
        document.addEventListener('dialog-signup-confirm-close', this.signupConfirmClose.bind(this));
        document.addEventListener('dialog-postbegin-open', this.postBeginOpen.bind(this));
        document.addEventListener('dialog-postbegin-close', this.postBeginClose.bind(this));

      }
    });
  </script>
</dom-module>